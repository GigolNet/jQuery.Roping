/*
 * jQuery
 * @copyright : GigolNet
 * @author : Ilia GUIGOLACHVILI
 * @web : http://gigol.net
 * @plugin : Roping
 * @version : 1.0.0
 * Last modified : 23/01/2015
 */
(function(a){a.fn.roping=function(g){var l=this;var k,j;var d,e,w,b;var v,s,u,t,i,o;var h,f,r,q;var c=a.extend({shepherd:a("#shepherd"),shepherd_x:0,shepherd_y:0,sheep_x:0,sheep_y:0,rope_width:1,rope_color:"black",rope_cap:"round"},g);var m=a('<canvas id="rope">Your browser does not support the HTML5 canvas tag.</canvas>').appendTo("body");var p=a(m).get(0).getContext("2d");var n=false;a(document).on("mousedown",function(x){n=true});a(document).on("mouseup",function(x){n=false});a(document).on("mousemove",function(x){if(n){w=c.shepherd.offset().left;b=c.shepherd.offset().top;e=c.shepherd.width();d=c.shepherd.height();k=l.offset().left;j=l.offset().top;v=(w+c.shepherd_x);s=(b+d+c.shepherd_y);t=(k+c.sheep_x);u=(j+c.sheep_y);if(w>k||(w+e)>k){i=parseInt(k/v);o=parseInt(j/s);h=2*i+v/2-2/k;f=2*o+s/2-2/j;r=(k+c.sheep_x);q=(j+c.sheep_y)}else{i=parseInt(k-v);o=parseInt(j-s);h=2*i-v/2-k/2;f=2*o-s/2-j/2;r=(k+c.sheep_x);q=(j+c.sheep_y)}if(t<=v){t=v}if(u<=s){u=s}m.attr("height",u);m.attr("width",t);m.css({position:"absolute",left:0,top:0,overflow:"none",margin:0,padding:0});p.clearRect(0,0,m.width,m.height);p.beginPath();p.moveTo(v,s);p.quadraticCurveTo(h,f,r,q);p.lineWidth=c.rope_width;p.lineCap=c.rope_cap;p.strokeStyle=c.rope_color;p.stroke()}})}}(jQuery));